<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>O CONTRATO — Desenvolvimento Pessoal com IA ⭐</title>
  <meta name="description" content="Responda e receba um plano de 30 dias. Pequenas vitórias diárias, contrato vivo.">
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#0b0b0b;color:#f6f6f6;line-height:1.6}
    main{text-align:center;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:60vh;padding:20px}
    h1{font-size:clamp(36px,8vw,80px);margin:0;font-weight:800}
    h2{font-size:clamp(18px,3vw,32px);margin:12px 0 24px;font-weight:500;color:#f59e0b}
    button{padding:14px 24px;font-size:clamp(16px,2vw,20px);font-weight:600;border:none;border-radius:12px;cursor:pointer;background:#f59e0b;color:#111;transition:background .2s}
    button:hover{background:#e6a700}
    section{padding:40px 20px;max-width:800px;margin:0 auto}
    form{display:grid;gap:16px;text-align:left}
    label{display:block;margin-bottom:4px;font-size:14px;color:#ddd}
    input,select,textarea{width:100%;padding:12px;border-radius:8px;border:none;background:#111;color:#fff}
    .preview{margin-top:30px;padding:20px;background:#111;border-radius:12px;position:relative}
    pre{white-space:pre-wrap;background:#0c0c0c;padding:16px;border-radius:10px;border:1px solid rgba(255,255,255,.08);margin-top:10px}
    .muted{opacity:.85}
    .status{max-width:800px;margin:10px auto 0;padding:10px 14px;border-radius:10px;background:#111;border:1px solid rgba(255,255,255,.1);font-size:14px;white-space:pre-wrap}
  </style>
</head>
<body>
  <main>
    <h1>O CONTRATO</h1>
    <h2>Desenvolvimento Pessoal com IA ⭐</h2>
    <button id="startBtn">Começar agora</button>
    <div id="status" class="status" style="display:none"></div>
  </main>

  <section id="bloco3">
    <h2>Responda e gere seu contrato</h2>
    <form id="qform">
      <div>
        <label>Seu objetivo principal (30 dias)</label>
        <input name="objetivo" placeholder="Ex.: Ler 1 livro, perder 2kg, estudar 20h..." required>
      </div>
      <div>
        <label>Por que isso importa agora?</label>
        <input name="porque" placeholder="Ex.: Saúde, carreira, energia...">
      </div>
      <div>
        <label>Tempo diário disponível</label>
        <select name="tempo">
          <option>5 minutos</option>
          <option>10 minutos</option>
          <option>25 minutos</option>
          <option>45 minutos</option>
        </select>
      </div>
      <div>
        <label>Recursos que você já tem (opcional)</label>
        <input name="recursos" placeholder="Ex.: App de foco, livro, academia...">
      </div>
      <div>
        <label>Obstáculo mais provável</label>
        <input name="obstaculo" placeholder="Ex.: Procrastinação, falta de tempo, distrações...">
      </div>
      <button type="submit">Gerar meu contrato</button>
    </form>

    <div id="preview" class="preview" style="display:none;">
      <h3>Seu contrato</h3>
      <pre id="cFull"></pre>
      <p class="muted">30 dias para mudar</p>
    </div>
  </section>

  <script>
    const $status = document.getElementById('status');
    const showStatus = (msg) => { $status.style.display='block'; $status.textContent = msg; };

    document.getElementById('startBtn').addEventListener('click', () => {
      document.getElementById('bloco3').scrollIntoView({ behavior:'smooth' });
    });

    // -------- Gerador local (fallback) --------
    function pickImpactActions(objetivo) {
      const o = (objetivo || "").toLowerCase();
      if (o.includes("ler") || o.includes("leitura")) {
        return [
          "Ler 10–15 páginas por dia no mesmo horário",
          "Anotar 3 ideias-chave ao final de cada sessão",
          "Revisar marcações 1x/semana por 10 minutos"
        ];
      }
      if (o.includes("estudar") || o.includes("prova") || o.includes("concurso")) {
        return [
          "Bloco diário de estudo focado (5–25 min) sem distrações",
          "Revisar resumos/flashcards 10 min/dia",
          "Exercícios práticos breves 3x/semana"
        ];
      }
      if (o.includes("perder") || o.includes("peso") || o.includes("emagrecer")) {
        return [
          "Caminhada leve diária (10–25 min) ou alongamento",
          "Trocar 1 lanche processado por fruta/água",
          "Planejar 3 refeições simples da semana no domingo"
        ];
      }
      if (o.includes("economiz") || o.includes("guardar") || o.includes("financ")) {
        return [
          "Anotar gastos em 2 categorias (essenciais/variáveis) diariamente (5 min)",
          "Definir teto de gasto variável para a semana",
          "Substituir 1 despesa recorrente por alternativa mais barata"
        ];
      }
      return [
        "Definir 1 micro-ação diária que puxe o objetivo (5–25 min)",
        "Registrar rapidamente o que foi feito ao final do dia (1–2 min)",
        "Reservar 10–15 min semanais para revisar e ajustar"
      ];
    }
    function normalizeTime(tempo) {
      if (!tempo) return "5–25 minutos";
      const t = (tempo + "").toLowerCase();
      if (t.includes("5")) return "5 minutos";
      if (t.includes("10")) return "10 minutos";
      if (t.includes("25")) return "25 minutos";
      if (t.includes("45")) return "45 minutos";
      return "5–25 minutos";
    }
    function generateLocalContract({ objetivo, porque, tempo, recursos, obstaculo }) {
      const actions = pickImpactActions(objetivo);
      const tempoTxt = normalizeTime(tempo);
      const porqueTxt = (porque && porque.trim()) ? porque.trim() : "priorizar meu progresso com passos curtos e consistentes";
      const recTxt = (recursos && recursos.trim()) ? `Usarei: ${recursos.trim()}. ` : "";
      const obsTxt = (obstaculo && obstaculo.trim()) ? obstaculo.trim() : "procrastinação";
      const linhas = [
        `Compromisso (30 dias): vou focar diariamente em ${objetivo || "meu objetivo principal"}, com disciplina gentil e constância.`,
        `Por que agora: ${porqueTxt}. Quero construir uma rotina que caiba na minha vida real e me mantenha avançando.`,
        `Ações de maior impacto (prioridades):`,
        `1) ${actions[0]}`,
        `2) ${actions[1]}`,
        `3) ${actions[2]}`,
        `Rotina diária: ${tempoTxt} por dia, em blocos curtos e 100% presentes. ${recTxt}Se um dia for corrido, farei pelo menos 5 minutos para manter a chama acesa.`,
        `Check-ins semanais: aos domingos (10–15 min) para revisar avanços, ajustar as ações e planejar a semana com clareza.`,
        `Mitigação de risco: quando eu falhar, retomo no mesmo dia com 5 minutos. Se perder um dia inteiro, recomeço pequeno no seguinte, sem culpa e sem drama.`,
        `Registro de progresso: vou anotar brevemente o que fiz a cada dia (1–2 min). Isso mantém a jornada visível e me dá energia para continuar.`
      ];
      return linhas.join("\n");
    }
    // -----------------------------------------

    async function generateFromAPI(data){
      try{
        showStatus("Chamando IA (OpenAI) em /api/contrato ...");
        const resp = await fetch('/api/contrato', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(data)
        });
        const text = await resp.text();
        let json; try { json = JSON.parse(text); } catch(e){ json = { error: 'Invalid JSON', raw: text }; }
        if(!resp.ok){
          showStatus(`Erro da IA (${resp.status}):\n` + (JSON.stringify(json, null, 2)));
          return null;
        }
        showStatus("IA conectada: resposta OK");
        return json;
      }catch(e){
        showStatus("Falha ao chamar IA: " + String(e));
        return null;
      }
    }

    const form = document.getElementById('qform');
    const preview = document.getElementById('preview');
    const cFull = document.getElementById('cFull');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(form).entries());
      const payload = await generateFromAPI(data);
      const fullText = (payload && payload.full) ? payload.full : generateLocalContract(data);
      cFull.textContent = fullText;
      preview.style.display = 'block';
      preview.scrollIntoView({ behavior:'smooth' });
    });
  </script>
</body>
</html>
