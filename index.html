<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>O CONTRATO — Desenvolvimento Pessoal com IA ⭐</title>
  <meta name="description" content="O CONTRATO é um site de desenvolvimento pessoal com IA. Responda perguntas simples e receba um plano personalizado.">
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#0b0b0b;color:#f6f6f6;line-height:1.6}
    main{text-align:center;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:60vh;padding:20px}
    h1{font-size:clamp(36px,8vw,80px);margin:0;font-weight:800}
    h2{font-size:clamp(18px,3vw,32px);margin:12px 0 24px;font-weight:500;color:#f59e0b}
    button{padding:14px 24px;font-size:clamp(16px,2vw,20px);font-weight:600;border:none;border-radius:12px;cursor:pointer;background:#f59e0b;color:#111;transition:background .2s}
    button:hover{background:#e6a700}

    section{padding:40px 20px;max-width:800px;margin:0 auto}
    form{display:grid;gap:16px;text-align:left}
    label{display:block;margin-bottom:4px;font-size:14px;color:#ddd}
    input,select,textarea{width:100%;padding:12px;border-radius:8px;border:none;background:#111;color:#fff}
    .preview{margin-top:30px;padding:20px;background:#111;border-radius:12px;position:relative}
    .status{max-width:800px;margin:10px auto 0;padding:10px 14px;border-radius:10px;background:#111;border:1px solid rgba(255,255,255,.1);font-size:14px;white-space:pre-wrap}
  </style>
</head>
<body>
  <main>
    <h1>O CONTRATO</h1>
    <h2>Desenvolvimento Pessoal com IA ⭐</h2>
    <button id="startBtn">Começar agora</button>
    <div id="status" class="status" style="display:none"></div>
  </main>

  <section id="bloco3">
    <h2>Responda e gere seu contrato</h2>
    <form id="qform">
      <div>
        <label>Seu objetivo principal (30 dias)</label>
        <input name="objetivo" placeholder="Ex.: Ler 1 livro, perder 2kg, estudar 20h..." required>
      </div>
      <div>
        <label>Por que isso importa agora?</label>
        <input name="porque" placeholder="Ex.: Saúde, carreira, energia...">
      </div>
      <div>
        <label>Tempo diário disponível</label>
        <select name="tempo">
          <option>5 minutos</option>
          <option>10 minutos</option>
          <option>25 minutos</option>
          <option>45 minutos</option>
        </select>
      </div>
      <div>
        <label>Obstáculo mais provável</label>
        <input name="obstaculo" placeholder="Ex.: Procrastinação, tempo, distrações...">
      </div>
      <button type="submit">Gerar meu contrato</button>
    </form>

    <div id="preview" class="preview" style="display:none;">
      <h3>Seu contrato</h3>
      <pre id="cFull" style="white-space:pre-wrap;background:#0c0c0c;padding:16px;border-radius:10px;border:1px solid rgba(255,255,255,.08);margin-top:10px"></pre>
      <p style="margin-top:10px;opacity:.85">30 dias para mudar</p>
    </div>
  </section>

  <script>
    const $status = document.getElementById('status');
    function showStatus(msg){ $status.style.display='block'; $status.textContent = msg; }

    document.getElementById('startBtn').addEventListener('click', () => {
      document.getElementById('bloco3').scrollIntoView({ behavior:'smooth' });
    });

    // Fallback local
    function simulateIA(data){
      return "Compromisso: pelos próximos 30 dias, vou focar em " + (data.objetivo||"meu objetivo") + ".\\n" +
             "Por que agora: " + (data.porque||"quero melhorar minha vida.") + "\\n" +
             "Vou priorizar 2–3 ações de maior impacto.";
    }

    async function generateFromAPI(data){
      try{
        showStatus("Chamando IA em /api/contrato ...");
        const resp = await fetch('/api/contrato', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(data)
        });
        const text = await resp.text();
        let json;
        try { json = JSON.parse(text); } catch(e){ json = { error: 'Invalid JSON', raw: text }; }
        if(!resp.ok){
          showStatus("Erro da API ("+resp.status+"):\\n"+(json.detail || json.error || text));
          return { preview: simulateIA(data) };
        }
        showStatus("IA conectada: resposta OK");
        return json;
      }catch(e){
        showStatus("Falha ao chamar IA: "+String(e));
        return { preview: simulateIA(data) };
      }
    }

    const form = document.getElementById('qform');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(form).entries());
      const payload = await generateFromAPI(data);
      const fullText = payload.full || payload.preview || simulateIA(data);
      document.getElementById('cFull').textContent = fullText;
      document.getElementById('preview').style.display = 'block';
      document.getElementById('preview').scrollIntoView({ behavior:'smooth' });
    });
  </script>
</body>
</html>
