<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>O CONTRATO ‚Äî Desenvolvimento Pessoal com IA ‚≠ê</title>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#0b0b0b;color:#f6f6f6;line-height:1.6}
    main{text-align:center;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:60vh;padding:20px}
    h1{font-size:clamp(36px,8vw,80px);margin:0;font-weight:800}
    h2{font-size:clamp(18px,3vw,32px);margin:12px 0 24px;font-weight:500;color:#f59e0b}
    button{padding:14px 24px;font-size:clamp(16px,2vw,20px);font-weight:600;border:none;border-radius:12px;cursor:pointer;background:#f59e0b;color:#111;transition:background .2s}
    button:hover{background:#e6a700}
    section{padding:40px 20px;max-width:800px;margin:0 auto}
    form{display:grid;gap:16px;text-align:left}
    label{display:block;margin-bottom:4px;font-size:14px;color:#ddd}
    input,select,textarea{width:100%;padding:12px;border-radius:8px;border:none;background:#111;color:#fff}
    .preview{margin-top:30px;padding:20px;background:#111;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.25)}
    pre{white-space:pre-wrap;background:#161616;padding:20px;border-radius:12px;border:1px solid rgba(255,255,255,.12);margin-top:12px;font-size:18px;line-height:1.75}
    .muted{opacity:.95;font-weight:700;margin-top:12px}
    .preview-footer{border-top:1px solid rgba(255,255,255,.08);padding-top:8px;margin-top:12px}
  </style>
</head>
<body>
  <main>
    <h1>O CONTRATO</h1>
    <h2>Desenvolvimento Pessoal com IA ‚≠ê</h2>
    <button id="startBtn">Come√ßar agora</button>
  </main>

  <section id="bloco3">
    <h2>Responda e gere seu contrato</h2>
    <form id="qform">
      <div>
        <label>Seu nome (para personalizar o contrato)</label>
        <input name="nome" placeholder="Ex.: George">
      </div>
      <div>
        <label>Seu objetivo principal (30 dias)</label>
        <input name="objetivo" placeholder="Ex.: Ler 1 livro, perder 2kg, estudar 20h..." required>
      </div>
      <div>
        <label>Por que agora?</label>
        <input name="porque" placeholder="Ex.: Sa√∫de, carreira, energia...">
      </div>
      <div>
        <label>Tempo di√°rio dispon√≠vel</label>
        <select name="tempo">
          <option>5 minutos</option>
          <option>10 minutos</option>
          <option>25 minutos</option>
          <option>45 minutos</option>
        </select>
      </div>
      <div>
        <label>Recursos que voc√™ j√° tem (opcional)</label>
        <input name="recursos" placeholder="Ex.: App de foco, livro, academia...">
      </div>
      <div>
        <label>Obst√°culo mais prov√°vel</label>
        <input name="obstaculo" placeholder="Ex.: Procrastina√ß√£o, falta de tempo, distra√ß√µes...">
      </div>
      <button type="submit">Gerar meu contrato</button>
    </form>

    <div id="preview" class="preview" style="display:none;">
      <h3>Seu contrato</h3>
      <pre id="cFull"></pre>
      <p class="muted preview-footer">üöÄ 30 dias para mudar</p>
    </div>
  </section>

  <script>
    document.getElementById('startBtn').addEventListener('click', () => {
      document.getElementById('bloco3').scrollIntoView({ behavior:'smooth' });
    });

    // Fallback local
    function pickImpactActions(objetivo) {
      const o = (objetivo || "").toLowerCase();
      if (o.includes("ler") || o.includes("leitura")) return [
        "Ler 10‚Äì15 p√°ginas por dia no mesmo hor√°rio",
        "Anotar 3 ideias-chave ao final de cada sess√£o",
        "Revisar marca√ß√µes 1x/semana por 10 minutos"
      ];
      if (o.includes("estudar") || o.includes("prova") || o.includes("concurso")) return [
        "Bloco di√°rio de estudo focado (5‚Äì25 min) sem distra√ß√µes",
        "Revisar resumos/flashcards 10 min/dia",
        "Exerc√≠cios pr√°ticos breves 3x/semana"
      ];
      if (o.includes("perder") || o.includes("peso") || o.includes("emagrecer")) return [
        "Caminhada leve di√°ria (10‚Äì25 min) ou alongamento",
        "Trocar 1 lanche processado por fruta/√°gua",
        "Planejar 3 refei√ß√µes simples da semana no domingo"
      ];
      if (o.includes("economiz") || o.includes("guardar") || o.includes("financ")) return [
        "Anotar gastos em 2 categorias diariamente (5 min)",
        "Definir teto de gasto vari√°vel para a semana",
        "Substituir 1 despesa recorrente por alternativa mais barata"
      ];
      return [
        "Definir 1 micro-a√ß√£o di√°ria que puxe o objetivo (5‚Äì25 min)",
        "Registrar o que foi feito ao final do dia (1‚Äì2 min)",
        "Reservar 10‚Äì15 min semanais para revisar e ajustar"
      ];
    }
    function normalizeTime(tempo) {
      if (!tempo) return "5‚Äì25 minutos";
      const t = (tempo + "").toLowerCase();
      if (t.includes("5")) return "5 minutos";
      if (t.includes("10")) return "10 minutos";
      if (t.includes("25")) return "25 minutos";
      if (t.includes("45")) return "45 minutos";
      return "5‚Äì25 minutos";
    }
    function generateLocalContract({ objetivo, porque, tempo, recursos, obstaculo, nome }) {
      const actions = pickImpactActions(objetivo);
      const tempoTxt = normalizeTime(tempo);
      const porqueTxt = (porque && porque.trim()) ? porque.trim() : "priorizar meu progresso com passos curtos e consistentes";
      const recTxt = (recursos && recursos.trim()) ? `Usarei: ${recursos.trim()}. ` : "";
      const firstPerson = (nome && nome.trim()) ? `Eu, ${nome.trim()}, ` : "";
      const linhas = [
        `üìÑ **Contrato de 30 dias: ${objetivo || "meu objetivo"}**`,
        ``,
        `ü§ù **Compromisso**`,
        `${firstPerson}me comprometo a executar este plano por 30 dias.`,
        ``,
        `‚è∞ **Por que agora?**`,
        `${porqueTxt}.`,
        ``,
        `üî• **A√ß√µes de maior impacto**`,
        `1Ô∏è‚É£ ${actions[0]}`,
        `2Ô∏è‚É£ ${actions[1]}`,
        `3Ô∏è‚É£ ${actions[2]}`,
        ``,
        `üìÖ **Rotina di√°ria**`,
        `${tempoTxt} por dia, em blocos curtos e 100% presentes. ${recTxt}Se um dia for corrido, farei pelo menos 5 minutos para manter a chama acesa.`,
        ``,
        `üìù **Check-ins semanais**`,
        `Todo domingo (10‚Äì15 min) para revisar avan√ßos, ajustar a√ß√µes e planejar a semana com clareza.`,
        ``,
        `üí™ **Retomada**`,
        `Se eu falhar, n√£o me critico. Reavalio, ajusto e retomo no dia seguinte.`
      ];
      return linhas.join("\n");
    }

    async function generateFromAPI(data){
      try{
        const resp = await fetch('/api/contrato', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(data)
        });
        const text = await resp.text();
        let json; try { json = JSON.parse(text); } catch(e){ return null; }
        if(!resp.ok) return null;
        return json;
      }catch(e){ return null; }
    }

    function formatContract(rawText, nome){
      let txt = rawText || "";
      txt = txt.replace(/\*\*Compromisso:\*\*/gi, "ü§ù **Compromisso**");
      txt = txt.replace(/\*\*Por que agora:?\??\*\*/gi, "‚è∞ **Por que agora?**");
      txt = txt.replace(/\*\*A√ß√µes de maior impacto:\*\*/gi, "üî• **A√ß√µes de maior impacto**");
      txt = txt.replace(/\*\*Rotina di√°ria:\*\*/gi, "üìÖ **Rotina di√°ria**");
      txt = txt.replace(/\*\*Check-ins semanais:\*\*/gi, "üìù **Check-ins semanais**");
      txt = txt.replace(/\*\*Retomada:\*\*/gi, "üí™ **Retomada**");
      txt = txt.replace(/^(\*\*Contrato.*\*\*)/m, "üìÑ $1");
      if (nome && nome.trim()) {
        txt = txt.replace(/Comprometo[\-\s]?me a/gi, "Eu, " + nome.trim() + ", me comprometo a");
        txt = txt.replace(/Eu me comprometo a/gi, "Eu, " + nome.trim() + ", me comprometo a");
        txt = txt.replace(/(ü§ù \*\*Compromisso\*\*[\s\S]*?\n)/, "$1Eu, " + nome.trim() + ", ");
      }
      return txt;
    }

    const form = document.getElementById('qform');
    const preview = document.getElementById('preview');
    const cFull = document.getElementById('cFull');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(form).entries());
      const payload = await generateFromAPI(data);
      let fullText = payload && payload.full ? formatContract(payload.full, data.nome) : generateLocalContract(data);
      cFull.textContent = fullText;
      preview.style.display = 'block';
      preview.scrollIntoView({ behavior:'smooth' });
    });
  </script>
</body>
</html>
