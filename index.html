<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>30 dias para mudar! ‚Äî O CONTRATO</title>
  <meta name="description" content="30 dias para mudar: gere um plano personalizado e acompanhe seu progresso com O CONTRATO.">
  <style>
    :root{
      --bg:#f7f7fb;
      --text:#14151a;
      --muted:#6b7280;
      --card:#ffffff;
      --primary:#4f46e5;   /* indigo */
      --accent:#10b981;    /* green */
      --border:#e5e7eb;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);line-height:1.6}
    header{padding:28px 20px;text-align:center}
    h1{font-size:clamp(34px,6vw,64px);margin:0 0 6px;font-weight:800;color:var(--primary)}
    .sub{font-weight:600;color:var(--muted)}
    main{padding:10px 20px 60px;max-width:960px;margin:0 auto}

    /* Journey / timeline */
    .journey{
      margin:26px 0 18px;background:var(--card);border:1px solid var(--border);
      border-radius:16px;padding:18px 20px;box-shadow:0 8px 28px rgba(17,24,39,.06)
    }
    .journey h3{margin:0 0 10px;font-size:18px}
    .line{
      position:relative;height:8px;border-radius:999px;background:linear-gradient(90deg,var(--primary),var(--accent));
      margin:10px 0 6px;
    }
    .tick{position:absolute;top:50%;transform:translate(-50%,-50%);width:14px;height:14px;border-radius:50%;background:#fff;border:2px solid var(--primary)}
    .tick.end{right:0;left:auto;border-color:var(--accent)}
    .legend{display:flex;justify-content:space-between;font-size:14px;color:var(--muted)}
    .legend b{color:var(--text)}

    section{margin-top:26px}
    form{display:grid;gap:16px;background:var(--card);border:1px solid var(--border);padding:20px;border-radius:16px;box-shadow:0 8px 28px rgba(17,24,39,.06)}
    label{display:block;margin-bottom:6px;font-size:14px;color:var(--muted);font-weight:600}
    input,select,textarea{
      width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:#fff;color:var(--text);
      font-size:16px;outline:none
    }
    button{
      padding:14px 20px;font-size:16px;font-weight:700;border:none;border-radius:12px;cursor:pointer;
      background:var(--primary);color:#fff;box-shadow:0 8px 20px rgba(79,70,229,.25);transition:transform .05s ease
    }
    button:active{transform:translateY(1px)}

    .preview{
      margin-top:22px;background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px;
      box-shadow:0 8px 28px rgba(17,24,39,.06)
    }
    .preview h3{margin:0 0 12px}
    pre{
      white-space:pre-wrap;background:#fff;padding:18px;border-radius:12px;border:1px solid var(--border);
      margin-top:12px;font-size:18px;line-height:1.75
    }
    .muted{color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <h1>30 dias para mudar!</h1>
    <div class="sub">O CONTRATO ‚Äî Desenvolvimento Pessoal com IA ‚≠ê</div>
  </header>

  <main>
    <!-- JOURNEY / PROGRESS -->
    <div class="journey" aria-label="Jornada de 30 dias">
      <h3>Jornada do Contrato</h3>
      <div class="line">
        <span class="tick" style="left:0%" aria-label="Dia 0"></span>
        <span class="tick end" style="right:0%" aria-label="Dia 30"></span>
      </div>
      <div class="legend">
        <span>Voc√™ est√° aqui: <b>Dia 0</b></span>
        <span>Objetivo: <b>Dia 30</b></span>
      </div>
    </div>

    <!-- FORM -->
    <section id="bloco3">
      <h2>Responda e gere seu contrato</h2>
      <form id="qform">
        <div>
          <label>Seu nome (para personalizar o contrato)</label>
          <input name="nome" placeholder="Ex.: George">
        </div>
        <div>
          <label>Seu objetivo principal (30 dias)</label>
          <input name="objetivo" placeholder="Ex.: Correr 3x por semana" required>
        </div>
        <div>
          <label>Por que agora?</label>
          <input name="porque" placeholder="Ex.: Sa√∫de, energia, bem-estar...">
        </div>
        <div>
          <label>Tempo dispon√≠vel</label>
          <select name="tempo">
            <option>5 minutos</option>
            <option>10 minutos</option>
            <option selected>25 minutos</option>
            <option>45 minutos</option>
          </select>
        </div>
        <div>
          <label>Recursos que voc√™ j√° tem (opcional)</label>
          <input name="recursos" placeholder="Ex.: App de foco, t√™nis, parque...">
        </div>
        <div>
          <label>Obst√°culo mais prov√°vel</label>
          <input name="obstaculo" placeholder="Ex.: Procrastina√ß√£o, tempo, distra√ß√µes...">
        </div>
        <button type="submit">Gerar meu contrato</button>
      </form>

      <!-- PREVIEW -->
      <div id="preview" class="preview" style="display:none;">
        <h3>Seu contrato</h3>
        <pre id="cFull"></pre>
      </div>
    </section>
  </main>

  <script>
    // Scroll suave
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('button[href="#bloco3"], #startBtn');
      if(btn){ document.getElementById('bloco3').scrollIntoView({ behavior:'smooth' }); }
    });

    // -------- Gerador local (fallback) --------
    function pickImpactActions(objetivo) {
      const o = (objetivo || "").toLowerCase();
      if (o.includes("correr") || o.includes("corrida")) return [
        "Preparo r√°pido: deixar roupas separadas na noite anterior",
        "Mini-aquecimento: 5 minutos antes de cada corrida",
        "Compromisso p√∫blico: contar seu plano a algu√©m de confian√ßa"
      ];
      if (o.includes("ler") || o.includes("leitura")) return [
        "Ler 10‚Äì15 p√°ginas no mesmo hor√°rio",
        "Anotar 3 ideias-chave ao final",
        "Revisar marca√ß√µes 1x/semana (10 min)"
      ];
      if (o.includes("estudar") || o.includes("prova") || o.includes("concurso")) return [
        "Bloco curto de estudo focado (5‚Äì25 min) sem distra√ß√µes",
        "Revisar resumos/flashcards 10 min/dia",
        "Exerc√≠cios pr√°ticos breves 3x/semana"
      ];
      if (o.includes("peso") || o.includes("emagrecer")) return [
        "Caminhada leve di√°ria (10‚Äì25 min) ou alongamento",
        "Trocar 1 lanche processado por fruta/√°gua",
        "Planejar 3 refei√ß√µes simples da semana"
      ];
      return [
        "Definir 1 micro-a√ß√£o di√°ria que puxe o objetivo (5‚Äì25 min)",
        "Registrar rapidamente o que foi feito (1‚Äì2 min)",
        "Reservar 10‚Äì15 min semanais para revisar e ajustar"
      ];
    }
    function normalizeTime(t){ t=(t||"")+"".toLowerCase();
      if(t.includes("5"))return "5 minutos"; if(t.includes("10"))return "10 minutos";
      if(t.includes("25"))return "25 minutos"; if(t.includes("45"))return "45 minutos"; return "5‚Äì25 minutos";
    }
    function generateLocalContract(d){
      const actions = pickImpactActions(d.objetivo);
      const tempoTxt = normalizeTime(d.tempo);
      const porqueTxt = d.porque?.trim() || "priorizar minha sa√∫de e progresso com passos curtos e consistentes";
      const recTxt = d.recursos?.trim() ? `Usarei: ${d.recursos.trim()}. ` : "";
      const nome = d.nome?.trim();
      const linhas = [
        `üìÑ **Contrato de 30 Dias: ${d.objetivo || "meu objetivo"}**`,
        ``,
        `ü§ù **Compromisso**`,
        `${nome ? `Eu, ${nome}, ` : "Eu, "}me comprometo a seguir este plano por 30 dias. Quando o dia estiver corrido, fa√ßo ao menos 5 minutos para manter a consist√™ncia.`,
        ``,
        `‚è∞ **Por que agora?**`,
        `${porqueTxt}.`,
        ``,
        `üî• **A√ß√µes de maior impacto**`,
        `1Ô∏è‚É£ ${actions[0]}`,
        `2Ô∏è‚É£ ${actions[1]}`,
        `3Ô∏è‚É£ ${actions[2]}`,
        ``,
        `üìÖ **Rotina di√°ria**`,
        `${tempoTxt} por sess√£o (ou conforme definido), com foco total e sem distra√ß√µes. ${recTxt}Se precisar, ajusto o hor√°rio para caber na rotina.`,
        ``,
        `üìù **Check-ins semanais**`,
        `Todo domingo (10‚Äì15 min) para revisar avan√ßos, ajustar a√ß√µes e planejar a semana seguinte.`,
        ``,
        `üí™ **Retomada**`,
        `Se eu perder um dia, retomo no seguinte com 5 minutos. O importante √© continuar.`,
        ``,
        `‚úçÔ∏è **Assinatura**`,
        `${nome ? `Eu, ${nome}, ` : "Eu, "}firmo este contrato comigo pelos pr√≥ximos 30 dias.`
      ];
      return linhas.join("\n");
    }
    // -----------------------------------------

    async function generateFromAPI(data){
      try{
        const resp = await fetch('/api/contrato', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(data)
        });
        const text = await resp.text();
        let json; try { json = JSON.parse(text); } catch { return null; }
        if(!resp.ok) return null;
        return json;
      }catch{ return null; }
    }

    function formatContract(txt, nome){
      if(!txt) return "";
      txt = txt.replace(/\*\*Compromisso:\*\*/gi, "ü§ù **Compromisso**");
      txt = txt.replace(/\*\*Por que agora:?\?\*\*/gi, "‚è∞ **Por que agora?**");
      txt = txt.replace(/\*\*A√ß√µes de maior impacto:\*\*/gi, "üî• **A√ß√µes de maior impacto**");
      txt = txt.replace(/\*\*Rotina di√°ria:\*\*/gi, "üìÖ **Rotina di√°ria**");
      txt = txt.replace(/\*\*Check-ins semanais:\*\*/gi, "üìù **Check-ins semanais**");
      txt = txt.replace(/\*\*Retomada:\*\*/gi, "üí™ **Retomada**");
      txt = txt.replace(/^(\*\*Contrato.*\*\*)/m, "üìÑ $1");
      if (nome && nome.trim()) {
        txt = txt.replace(/Comprometo[\-\s]?me a/gi, "Eu, " + nome.trim() + ", me comprometo a");
        txt = txt.replace(/Eu me comprometo a/gi, "Eu, " + nome.trim() + ", me comprometo a");
        txt = txt.replace(/(ü§ù \*\*Compromisso\*\*[\s\S]*?\n)/, "$1Eu, " + nome.trim() + ", ");
      }
      return txt;
    }

    const form = document.getElementById('qform');
    const preview = document.getElementById('preview');
    const cFull = document.getElementById('cFull');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(form).entries());
      const payload = await generateFromAPI(data);
      let baseText = payload?.full ? payload.full : generateLocalContract(data);
      const fullText = payload?.full ? formatContract(baseText, data.nome) : baseText;
      cFull.textContent = fullText;
      preview.style.display = 'block';
      preview.scrollIntoView({ behavior:'smooth' });
      // Atualiza legenda da jornada (ainda est√°tica visualmente)
      document.querySelector('.legend span b').textContent = 'Dia 0';
    });
  </script>
</body>
</html>
